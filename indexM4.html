<!DOCTYPE html>
<!-- sheet : workshop662 -->
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width
    , initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
  <link href="https://cdn.datatables.net/responsive/2.4.0/css/responsive.bootstrap5.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <link href="./style.css" rel="stylesheet" />
  <title>iSuchart :: Workshop662</title>
</head>

<body>
  <div class="container mb-5">
      <h4 class="my-3 text-left"><i class="fa-solid fa-address-card"></i> บันทึกข้อมูล</h4>
      
      <form id="data-form">
        <div class="form-title d-none">
          <label for="ID">รหัส</label>
          <input type="text" class="form-control" id="ID" readonly />
        </div>

        <div class="row">
          <h6 class="mt-2 text-primary"><i class="fa-solid fa-house"></i> ข้อมูลระดับชั้นและเรื่อง</h6>
          <hr>
          <!-- <div class="col-md-3 mb-2">
            <label for="room">ระดับชั้น</label>
            <input type="text" class="form-control" id="room" name="room" placeholder="พิมพ์ชื่อสถานศึกษา" required>
          </div> -->

          <div class="col-md-3 mb-2">
            <label for="room">ห้อง</label
            >
            <select class="form-select"
                name="room" 
                id="room" required>
                <option value="#" selected disabled>เลือกระดับชั้น</option>
                <option value="ม.4/8">ม.4/8</option>
                <option value="ม.4/10">ม.4/10</option>
                <!-- <option value="ม.5/6">ม.5/6</option>
                <option value="ม.5/7">ม.5/7</option>
                <option value="ม.5/8">ม.5/8</option>
                <option value="ม.5/9">ม.5/9</option> -->
            </select>
        </div>
        
        <div class="col-md-3 mb-2">
          <label for="title">เรื่อง(เล่มเอกสาร)</label>
          <select class="form-select"
              name="title" 
              id="title" required>
              <option value="#" selected disabled>เลือกเรื่อง</option>
              <option value="ฟังก์ชัน">ม.4:ฟังก์ชัน</option>
              <option value="เรขาคณิตฯ">ม.4:เรขาคณิตฯ</option>
              <option value="เลขยกกำลัง">ม.4:เลขยกกำลัง</option>
              <option value="ภาคตัดกรวย">ม.4:ภาคตัดกรวย</option>
              <option value="ฟังก์ชันExponential">ม.4:ฟังก์ชันExponential</option>
          </select>
      </div>

      <div class="col-md-3 mb-2">
        <label for="sheet">หน้า</label>
        <input type="tel" class="form-control" id="sheet" name="sheet" placeholder="พิมพ์เลขหน้า, ปก=0 " required>
    </div>

          <h6 class="mt-2 text-primary"><i class="fa-solid fa-circle-user"></i> ข้อมูลของนักเรียน</h6>
          <hr>

          <div class="col-md-3 mb-2">
            <label for="prename">คำนำหน้าชื่อ</label>
            <select class="form-select"
                name="prename" 
                id="prename" required>
                <option value="#" selected disabled>เลือกคำนำหน้าชื่อ</option>
                <option value="นาย">นาย</option>
                <option value="นางสาว">นางสาว</option>
            </select>
        </div>

          <div class="col-md-3 mb-2">
            <label for="dname">ชื่อนักเรียน</label>
            <input type="text" class="form-control" id="dname" name="dname" placeholder="พิมพ์ชื่อนักเรียน" required>
          </div>
          <div class="col-md-3 mb-2">
            <label for="dtel">นามสกุล</label>
            <input type="text" class="form-control" id="dtel" name="dtel" placeholder="นามสกุลนักเรียน" required>
          </div>
          <div class="col-md-3 mb-2">
            <label for="d_email">เลขที่</label>
            <input type="tel" class="form-control" id="d_email" name="d_email" placeholder="พิมพ์เลขที่" required>
          </div>

          
          <h6 class="mt-2 text-primary"><i class="fa-solid fa-circle-user"></i> ข้อมูลผลงาน</h6>
          <hr>
          <div class="col-md-3 mb-2">
            <label for="d_line">คะแนน</label>
            <input type="tel" class="form-control" id="d_line" name="d_line" placeholder="พิมพ์คะแนน" required>
          </div>
          <div class="mb-0 col-md-3">
            <label for="file" class="form-label">รูปหลักฐาน</label>
            <input class="form-control" type="file" name="imgfile1" id="imgfile1" accept="image/*" required />
            <img class="mt-0" id="img1" src="" alt="" width="100px" />
          </div>
          
        </div>
      </form>

      <div class="modal-footer">
        <button id="btn-senddata" type="submit" class="btn btn-primary form-control">
          บันทึกข้อมูล
        </button>
      </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- <script src="script.js"></script> -->
  
  <script>
    const url = "https://script.google.com/macros/s/AKfycbzRt_SdL4R65GSisBB3Mdc1Rez_Ga1LW4llnuJUQTSy6OA4_I94UBfl0oQtMC7kYdlo/exec"; //Change API URL 
    //อ่านข้อมูลจาก API
    //chatGPT
    fetch(url)
      .then((response) => response.json())
      .then(json => {
        // Do something with the data
        // console.log(json);
        // console.log(json[0][1]);
      })
    //v
    //ดร.วิเชียร
    fetch(url)
      .then((res) => res.text())
      .then((resdata) => {
        //Parsing the JSON
        const data = JSON.parse(resdata);
        // console.log(data)
      })
    const file1 = document.querySelector("#imgfile1");
    const img1 = document.querySelector("#img1");
    // const file2 = document.querySelector("#imgfile2");
    // const img2 = document.querySelector("#img2");
    let spt1 = "";
    let type1 = "";
    let imgname1 = "";
    // let spt2 = "";
    // let type2 = "";
    // let imgname2 = "";

    file1.addEventListener("change", () => {
      let fr = new FileReader();
      fr.addEventListener("loadend", () => {
        const res = fr.result;
        img1.src = res;
        spt1 = res.split("base64,")[1];
        imgname1 = file1.files[0].name;
        type1 = file1.files[0].type;
      });
      fr.readAsDataURL(file1.files[0]);
    });

    // file2.addEventListener("change", () => {
    //   let fr = new FileReader();
    //   fr.addEventListener("loadend", () => {
    //     const res = fr.result;
    //     img2.src = res;
    //     spt2 = res.split("base64,")[1];
    //     type2 = file2.files[0].type;
    //     imgname2 = file2.files[0].name;
    //   });
    //   fr.readAsDataURL(file2.files[0]);
    // });


    //Save data to sheet
    const btnsubmit = document.querySelector("#btn-senddata");
    btnsubmit.addEventListener("click", (event) => {
      event.preventDefault();
      startloading();
      const inputname = document.querySelector("#dname").value;
      // console.log(inputname)
      if (spt1 === "" || inputname === "") {
        popup("ตรวจสอบข้อมูลอีกครั้ง");
      } else {
        const obj = {
          action: "write",
          room: $("#room").val(),
          title: $("#title").val(),
          sheet: $("#sheet").val(),
          prename: $("#prename").val(),
          dname: $("#dname").val(),
          dtel: $("#dtel").val(),
          d_email: $("#d_email").val(),
          d_line: $("#d_line").val(),
          // tname: $("#tname").val(),
          // t_tel: $("#t_tel").val(),
          // t_email: $("#t_email").val(),
          // t_line: $("#t_line").val(),
          dataimg1: spt1,
          type1: type1,
          imgname1: imgname1,
          // dataimg2: spt2,
          // type2: type2,
          // imgname2: imgname2
        };

        fetch(url, {
          method: "POST",
          body: JSON.stringify(obj)
        })
          .then((r) => r.text())
          .then((data) => {
            popup(data);
            console.log(data);
            // readdata();
          });
        // $("#btn-close").click();
        // location.reload();
      }
    });

    //Start Loader
    function startloading() {
      $("#balloon").addClass("d-none")
      $("html").css("overflow", "hidden");
      $("#overlay").show();
    }

    //Stop Loader
    function stoploading() {
      $("#balloon").removeClass("d-none")
      $("#overlay").hide();
      $("html").css("overflow", "visible");
    }

    //Open image
    function open_img(e) {
      //console.log(e);
      const imglink = "https://lh5.googleusercontent.com/d/" + e;
      $("#imgmodal").attr("src", imglink);
    }

    function popup(e) {
      Swal.fire({
        title: e,
        text: "",
        imageUrl: "https://cdn-icons-png.flaticon.com/128/5978/5978223.png",
        imageWidth: 80,
        imageHeight: 80
      });
      $("#data-form")[0].reset()
    }
  </script>
</body>

</html>